# ============================================
# DEMO: TH·ª® T·ª∞ OVERRIDE C·ª¶A BI·∫æN M√îI TR∆Ø·ªúNG
# ============================================

name: Demo ENV Override

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Ch·ªçn m√¥i tr∆∞·ªùng'
        type: choice
        options: [dev, uat]
        default: 'dev'

# ============================================
# C·∫§P ƒê·ªò 1: WORKFLOW ENV (Th·∫•p nh·∫•t)
# ============================================
env:
  MY_VAR: "workflow-level"
  ONLY_WORKFLOW: "ch·ªâ c√≥ ·ªü workflow"

jobs:
  test:
    runs-on: ubuntu-latest
    environment: ${{ inputs.environment }}  # dev ho·∫∑c uat
    
    # ============================================
    # C·∫§P ƒê·ªò 2: JOB ENV (Override workflow)
    # ============================================
    env:
      MY_VAR: "job-level"           # Override workflow
      ONLY_JOB: "ch·ªâ c√≥ ·ªü job"

    steps:
      - name: üìä Xem t·∫•t c·∫£ bi·∫øn
        # ============================================
        # C·∫§P ƒê·ªò 3: STEP ENV (Override job & workflow)
        # ============================================
        env:
          MY_VAR: "step-level"      # Override job & workflow
          ONLY_STEP: "ch·ªâ c√≥ ·ªü step"
          # L·∫•y t·ª´ GitHub Environment (dev/uat)
          FROM_SECRET: ${{ secrets.MY_PASSWORD }}
          FROM_VAR: ${{ vars.MY_WEBSITE }}
        run: |
          echo "=========================================="
          echo "üìå K·∫æT QU·∫¢ OVERRIDE"
          echo "=========================================="
          echo ""
          echo "ÔøΩ MY_VAR (b·ªã override qua 3 c·∫•p):"
          echo "   Gi√° tr·ªã cu·ªëi: $MY_VAR"        # step-level
          echo ""
          echo "üìç Bi·∫øn ch·ªâ c√≥ ·ªü t·ª´ng c·∫•p:"
          echo "   ONLY_WORKFLOW: $ONLY_WORKFLOW"
          echo "   ONLY_JOB: $ONLY_JOB"
          echo "   ONLY_STEP: $ONLY_STEP"
          echo ""
          echo "üîê T·ª´ GitHub Environment '${{ inputs.environment }}':"
          echo "   FROM_SECRET: $FROM_SECRET"
          echo "   FROM_VAR: $FROM_VAR"
          echo ""
          echo "=========================================="

      - name: üìä Step 2 - Kh√¥ng c√≥ step env
        run: |
          echo "=========================================="
          echo "üìå STEP 2 (Kh√¥ng c√≥ step env)"
          echo "=========================================="
          echo ""
          echo "MY_VAR: $MY_VAR"           # job-level (kh√¥ng b·ªã step override)
          echo "ONLY_WORKFLOW: $ONLY_WORKFLOW"
          echo "ONLY_JOB: $ONLY_JOB"
          echo "ONLY_STEP: $ONLY_STEP"     # R·ªóng! (ch·ªâ c√≥ ·ªü step 1)
          echo ""
          echo "=========================================="