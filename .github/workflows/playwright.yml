# ============================================
# WORKFLOW DEMO - GIáº¢I THÃCH Cáº¤U TRÃšC GITHUB ACTIONS
# ============================================

# ğŸ“Œ TÃŠN WORKFLOW - Hiá»ƒn thá»‹ trÃªn tab Actions cá»§a GitHub
name: Demo CI/CD Workflow

# ğŸ“Œ TRIGGER - Khi nÃ o workflow cháº¡y?
on:
  push:
    branches: [main]           # Cháº¡y khi push vÃ o main
  pull_request:
    branches: [main]           # Cháº¡y khi táº¡o PR vÃ o main
  workflow_dispatch:           # Cho phÃ©p cháº¡y thá»§ cÃ´ng tá»« UI

# ğŸ“Œ BIáº¾N MÃ”I TRÆ¯á»œNG CHUNG - DÃ¹ng cho táº¥t cáº£ jobs
env:
  PROJECT_NAME: "Demo Project"
  NODE_VERSION: "20"

# ============================================
# DANH SÃCH JOBS - CÃ¡c cÃ´ng viá»‡c cáº§n thá»±c hiá»‡n
# ============================================
jobs:

  # ----------------------------------------
  # JOB 1: TEST - Cháº¡y kiá»ƒm thá»­
  # ----------------------------------------
  test:
    name: ğŸ§ª Cháº¡y Tests
    runs-on: ubuntu-latest     # MÃ¡y áº£o Ä‘á»ƒ cháº¡y job
    timeout-minutes: 10        # Tá»‘i Ä‘a 10 phÃºt

    # MATRIX STRATEGY - Cháº¡y trÃªn nhiá»u cáº¥u hÃ¬nh
    strategy:
      fail-fast: false         # Náº¿u 1 config fail, váº«n cháº¡y tiáº¿p
      matrix:
        browser: [chrome, firefox, webkit]  # 3 browsers
        # Sáº½ táº¡o 3 jobs song song: chrome, firefox, webkit

    steps:
      # Step 1: Checkout code tá»« repo
      - name: ğŸ“¥ Checkout code
        run: echo "BÆ°á»›c 1 - Äang checkout code tá»« repository..."

      # Step 2: CÃ i Ä‘áº·t dependencies
      - name: ï¿½ CÃ i Ä‘áº·t dependencies
        run: |
          echo "BÆ°á»›c 2 - CÃ i Ä‘áº·t dependencies..."
          echo "  â†’ npm install"
          echo "  â†’ CÃ i browser: ${{ matrix.browser }}"

      # Step 3: Cháº¡y test
      - name: ğŸ§ª Cháº¡y test trÃªn ${{ matrix.browser }}
        run: |
          echo "BÆ°á»›c 3 - Cháº¡y test..."
          echo "  â†’ Browser: ${{ matrix.browser }}"
          echo "  â†’ Project: ${{ env.PROJECT_NAME }}"
          echo "  â†’ Node version: ${{ env.NODE_VERSION }}"
          echo ""
          echo "âœ… Test passed trÃªn ${{ matrix.browser }}!"

      # Step 4: Upload káº¿t quáº£ test
      - name: ğŸ“Š Upload káº¿t quáº£
        run: |
          echo "BÆ°á»›c 4 - Upload test results..."
          echo "  â†’ Artifact: test-results-${{ matrix.browser }}"

  # ----------------------------------------
  # JOB 2: DEPLOY - Triá»ƒn khai lÃªn server
  # ----------------------------------------
  deploy:
    name: ğŸš€ Deploy
    runs-on: ubuntu-latest
    needs: test                # âš ï¸ CHá»œ JOB "test" HOÃ€N THÃ€NH Má»šI CHáº Y

    steps:
      - name: ğŸ“¥ Download artifacts
        run: echo "BÆ°á»›c 1 - Download káº¿t quáº£ test tá»« Job 1..."

      - name: ï¿½ï¸ Build project
        run: |
          echo "BÆ°á»›c 2 - Build project..."
          echo "  â†’ npm run build"

      - name: ğŸš€ Deploy lÃªn server
        run: |
          echo "BÆ°á»›c 3 - Äang deploy..."
          echo "  â†’ Server: production"
          echo "  â†’ Project: ${{ env.PROJECT_NAME }}"
          echo ""
          echo "âœ… Deploy thÃ nh cÃ´ng!"

      - name: ğŸ“§ ThÃ´ng bÃ¡o hoÃ n táº¥t
        run: |
          echo "=========================================="
          echo "ğŸ‰ WORKFLOW HOÃ€N Táº¤T!"
          echo "=========================================="
          echo "ğŸ“… Thá»i gian: $(date)"
          echo "ğŸ‘¤ NgÆ°á»i trigger: ${{ github.actor }}"
          echo "ğŸ“¦ Repository: ${{ github.repository }}"
          echo "ğŸŒ¿ Branch: ${{ github.ref_name }}"
          echo "=========================================="